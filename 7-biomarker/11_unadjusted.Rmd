---
title: |
  Unadjusted Analyses
author: "Sajia Darwish"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  pdf_document:
    toc: yes
    toc_depth: '4'
  html_document:
    toc: yes
    toc_depth: 4
keep_tex: yes
theme: bclear
fontsize: 12pt
geometry: margin=1in
header-includes:
- \usepackage{enumitem}
- \usepackage{indentfirst}
- \usepackage[default, scale=1]{raleway}
- \usepackage[T1]{fontenc}
- \usepackage{inconsolata}
always_allow_html: yes
---

```{r}
# Load the data
data <- read.csv("/data/imic/data/raw_lab_data/elicit/merged_elicit/longDataset.csv")

data $ X <- NULL

id <- c("bmid_base", "country", "studyid", "subjid", "subjido", 
        "arm_base", "sex_base", "brthyr_base", "brthweek_base", "mage_base", 
        "parity_base", "nlchild_base", "nperson_base", "nrooms_base", 
        "meducyrs_base", "h2osrcp_base", "cookplac_base", "epoch_base", 
        "mhtcm_base", "mwtkg_base", "mbmi_base", "dlvloc_base", "wtkg_base", 
        "lencm_base", "bmi_base", "waz_base", "haz_base", "whz_base", 
        "baz_base", "agedays_base", "dur_bf_base", "dur_ebf_base", "haz_6m")

# Change to wide format
wide <- data %>% 
  pivot_wider(id_cols = id,
              names_from = biomarker,
              values_from = value)

wide <- wide %>%
  select(!c("bmid_base", "country", "studyid", "subjid", "subjido", 
        "arm_base", "sex_base", "brthyr_base", "brthweek_base", "mage_base", 
        "parity_base", "nlchild_base", "nperson_base", "nrooms_base", 
        "meducyrs_base", "h2osrcp_base", "cookplac_base", "epoch_base", 
        "mhtcm_base", "mwtkg_base", "mbmi_base", "dlvloc_base", "wtkg_base", 
        "lencm_base", "bmi_base", "waz_base", "haz_base", "whz_base", 
        "baz_base", "agedays_base", "dur_bf_base", "dur_ebf_base"))

# Define the predictor
predictor <- "haz_6m"

# Run the linear regressions for each biomarker
results <- data.frame()
for (i in 2:length(wide)) {
  # Get the biomarker name
  biomarker <- colnames(wide)[i]
  # Run the regression
  regression <- lm(wide[[i]] ~ wide[[predictor]])
  # Extract the regression estimate and p-value
  estimate <- regression$coefficients[2]
  pvalue <- summary(regression)$coefficients[2, 4]
  # Calculate the Bonferroni adjusted p-value
  bonferroni_pvalue <- p.adjust(pvalue, method = "bonferroni", n = length(wide)-1)
  # Add the results to the table
  results <- rbind(results, data.frame(biomarker = biomarker, 
                                        outcome = "haz_6m", 
                                        estimate = estimate, 
                                        pvalue = pvalue, 
                                        bonferroni_pvalue = bonferroni_pvalue))
}

# Print the results
print(results)

results <- results[order(results$pvalue, decreasing=FALSE),]

# Save
write.csv(results, file = "/data/imic/results/unadjustedElicit.csv")
```


















